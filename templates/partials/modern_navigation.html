{# هذا الملف يمثل القائمة الجانبية (Sidebar) في ملف layouts/base.html - تصميم أتلانتس المحسن #}

<ul class="nav-list">
    {# لوحة التحكم/المشاريع (Core) #}
    <li>
        <a href="{{ url_for('project.get_projects') }}" class="nav-link {% if request.endpoint in ['project.get_projects', 'project.get_project', 'project.project_dashboard', 'item.get_items_by_project'] %}active{% endif %}">
            <i class="fas fa-fw fa-project-diagram me-2"></i>
            <span>المشاريع</span>
        </a>
    </li>
    
    {# الملخص المالي الشامل (Core - للمدراء فقط) #}
    {% if current_user.role in ['admin', 'sub-admin'] %}
    <li>
        <a href="{{ url_for('project.projects_summary') }}" class="nav-link {% if request.endpoint == 'project.projects_summary' %}active{% endif %}">
            <i class="fas fa-fw fa-chart-line me-2"></i>
            <span>الملخص المالي الشامل</span>
        </a>
    </li>
    {% endif %}
    
    {# المقاولون والموردون (Core) #}
    <li>
        <a href="{{ url_for('contractor.get_contractors') }}" class="nav-link {% if request.endpoint in ['contractor.get_contractors', 'contractor.show_contractor'] %}active{% endif %}">
            <i class="fas fa-fw fa-hard-hat me-2"></i>
            <span>المقاولون والموردون</span>
        </a>
    </li>
    
    <li class="nav-item-separator my-3"><hr class="dropdown-divider"></li>
    
    {# النماذج (Forms) - NEW #}
    <li>
        <a href="{{ url_for('forms.index') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('forms.') %}active{% endif %}">
            <i class="fas fa-fw fa-file-alt me-2"></i>
            <span>النماذج</span>
        </a>
    </li>
    
    {# أوامر الصرف (Payment Orders) - NEW #}
    <li>
        <a href="{{ url_for('payment_orders.index') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('payment_orders.') %}active{% endif %}">
            <i class="fas fa-fw fa-money-check-alt me-2"></i>
            <span>أوامر الصرف</span>
        </a>
    </li>
    
    {# جداول الكميات (BOQ) - NEW #}
    <li>
        <a href="{{ url_for('boq.index') }}" class="nav-link {% if request.endpoint and request.endpoint.startswith('boq.') %}active{% endif %}">
            <i class="fas fa-fw fa-table me-2"></i>
            <span>جداول الكميات</span>
        </a>
    </li>
    
    <li class="nav-item-separator my-3"><hr class="dropdown-divider"></li>
    
    {# سجلات الدفعات وأوامر الشراء (Global - Grouped for clarity) #}
    <li class="nav-item has-submenu">
        <a href="#" class="nav-link sidebar-toggler {% if request.endpoint in ['payment.get_all_payments', 'po.get_all_purchase_orders'] %}is-active{% endif %}">
            <i class="fas fa-fw fa-globe me-2"></i>
            <span>السجلات الشاملة</span>
            <i class="fas fa-chevron-left toggle-icon ms-auto"></i>
        </a>
        <ul class="sidebar-submenu" style="{% if request.endpoint in ['payment.get_all_payments', 'po.get_all_purchase_orders'] %}max-height: 100px; opacity: 1;{% endif %}">
            <li>
                <a href="{{ url_for('payment.get_all_payments') }}" class="sub-link {% if request.endpoint == 'payment.get_all_payments' %}active{% endif %}">
                    <i class="fas fa-cash-register me-2"></i> سجل الدفعات
                </a>
            </li>
            <li>
                <a href="{{ url_for('po.get_all_purchase_orders') }}" class="sub-link {% if request.endpoint == 'po.get_all_purchase_orders' %}active{% endif %}">
                    <i class="fas fa-file-contract me-2"></i> سجل أوامر الشراء (PO)
                </a>
            </li>
        </ul>
    </li>

    {# قائمة المشاريع المنبثقة (Quick Jump) #}
    {% if sidebar_projects %}
    <li class="nav-item has-submenu">
        <a href="#" class="nav-link sidebar-toggler">
            <i class="fas fa-fw fa-folder me-2"></i>
            <span>الانتقال السريع لمشروع</span>
            <i class="fas fa-chevron-left toggle-icon ms-auto"></i>
        </a>
        <ul class="sidebar-submenu">
            {% for project in sidebar_projects %}
            <li>
                <a href="{{ url_for('project.get_project', project_id=project.id) }}" class="sub-link">
                    <i class="fas fa-circle me-1"></i>
                    {{ project.name | truncate(25) }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </li>
    {% endif %}

    {# لوحة تحكم المسؤول (للمشرفين فقط - Bottom Link) #}
    {% if current_user.role == 'admin' %}
    <li class="mt-4">
        <a href="{{ url_for('auth.admin_dashboard') }}" class="nav-link {% if request.endpoint in ['auth.admin_dashboard', 'auth.edit_user'] %}active{% endif %} text-danger fw-bold">
            <i class="fas fa-fw fa-user-shield me-2"></i>
            <span>لوحة تحكم المسؤول</span>
        </a>
    </li>
    {% endif %}
</ul>