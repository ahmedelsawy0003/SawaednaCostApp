{% extends "layouts/base.html" %}

{% block title %}الملخص المالي للمشاريع{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-chart-line fa-fw me-2 text-muted"></i>الملخص المالي لجميع المشاريع النشطة</h1>
</div>

<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="fas fa-calculator me-2"></i>الإجماليات الكلية للمحفظة</h4>
    </div>
    <div class="card-body">
        <div class="row text-center g-3">
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 bg-light">
                    <h5 class="text-muted small">التكلفة التعاقدية</h5>
                    <p class="fs-4 text-info fw-bold number-cell">{{ "{:,.2f}".format(totals.contract_cost) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-primary">
                    <h5 class="text-muted small">التكلفة الفعلية</h5>
                    <p class="fs-4 text-primary fw-bold number-cell">{{ "{:,.2f}".format(totals.actual_cost) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-success">
                    <h5 class="text-muted small">إجمالي المدفوع</h5>
                    <p class="fs-4 text-success fw-bold number-cell">{{ "{:,.2f}".format(totals.paid_amount) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-danger">
                    <h5 class="text-muted small">إجمالي المتبقي</h5>
                    <p class="fs-4 text-danger fw-bold number-cell">{{ "{:,.2f}".format(totals.remaining_amount) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-list-alt me-1"></i>تفاصيل كل مشروع على حدة</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-dark table-hover table-striped mb-0">
                <thead>
                    <tr>
                        <th>اسم المشروع</th>
                        <th class="text-end">التكلفة التعاقدية</th>
                        <th class="text-end">التكلفة الفعلية</th>
                        <th class="text-end">إجمالي المدفوع</th>
                        <th class="text-end">المبلغ المتبقي</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td>
                            <a href="{{ url_for('project.get_project', project_id=project.id) }}" class="fw-bold">{{ project.name }}</a>
                        </td>
                        <td class="number-cell text-end text-info">{{ "{:,.2f}".format(project.total_contract_cost) }}</td>
                        <td class="number-cell text-end text-primary">{{ "{:,.2f}".format(project.total_actual_cost) }}</td>
                        <td class="number-cell text-end text-success">{{ "{:,.2f}".format(project.total_paid_amount) }}</td>
                        <td class="number-cell text-end text-danger">{{ "{:,.2f}".format(project.total_remaining_amount) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}