{% extends "layouts/base.html" %}

{% block title %}الملخص المالي للمشاريع{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-chart-line fa-fw me-2 text-primary"></i>الملخص المالي لجميع المشاريع النشطة</h1>
</div>

<div class="card mb-4">
    <div class="card-header bg-dark text-white">
        <h4 class="mb-0"><i class="fas fa-calculator me-2"></i>الإجماليات الكلية للمحفظة</h4>
    </div>
    <div class="card-body">
        <div class="row text-center g-3">
            {# Card 1: Contract Cost - Info #}
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 bg-light border-info border-3">
                    <h5 class="text-muted small">إجمالي التكلفة التعاقدية</h5>
                    <p class="fs-4 text-info fw-bold mb-0 number-cell">{{ "{:,.2f}".format(totals.contract_cost) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            
            {# Card 2: Actual Cost - Primary #}
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-primary border-3">
                    <h5 class="text-muted small">إجمالي التكلفة الفعلية</h5>
                    <p class="fs-4 text-primary fw-bold mb-0 number-cell">{{ "{:,.2f}".format(totals.actual_cost) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            
            {# Card 3: Paid Amount - Success #}
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-success border-3">
                    <h5 class="text-muted small">إجمالي المدفوعات</h5>
                    <p class="fs-4 text-success fw-bold mb-0 number-cell">{{ "{:,.2f}".format(totals.paid_amount) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
            
            {# Card 4: Remaining Amount - Danger #}
            <div class="col-md-3">
                <div class="p-3 border rounded h-100 border-danger border-3">
                    <h5 class="text-muted small">إجمالي المتبقي للاستحقاق</h5>
                    <p class="fs-4 text-danger fw-bold mb-0 number-cell">{{ "{:,.2f}".format(totals.remaining_amount) }} <span class="small text-muted">ر.س</span></p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-list-alt me-1"></i>تفاصيل كل مشروع على حدة</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            {# Removed table-dark class #}
            <table class="table table-hover table-striped mb-0">
                <thead>
                    <tr>
                        <th style="width: 25%;">اسم المشروع</th>
                        <th class="text-end" style="width: 17.5%;">التكلفة التعاقدية (ر.س)</th>
                        <th class="text-end" style="width: 17.5%;">التكلفة الفعلية (ر.س)</th>
                        <th class="text-end" style="width: 17.5%;">إجمالي المدفوع (ر.س)</th>
                        <th class="text-end" style="width: 17.5%;">المبلغ المتبقي (ر.س)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td>
                            <a href="{{ url_for('project.get_project', project_id=project.id) }}" class="fw-bold">{{ project.name }}</a>
                        </td>
                        <td class="number-cell text-end text-info">{{ "{:,.2f}".format(project.total_contract_cost) }}</td>
                        <td class="number-cell text-end text-primary">{{ "{:,.2f}".format(project.total_actual_cost) }}</td>
                        <td class="number-cell text-end text-success">{{ "{:,.2f}".format(project.total_paid_amount) }}</td>
                        <td class="number-cell text-end text-danger">{{ "{:,.2f}".format(project.total_remaining_amount) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="alert alert-light text-muted small m-3 p-2 text-center">
            <i class="fas fa-info-circle me-1"></i> لعرض التفاصيل الكاملة والمؤشرات لكل مشروع، اضغط على اسم المشروع في القائمة.
        </div>
    </div>
</div>
{% endblock %}